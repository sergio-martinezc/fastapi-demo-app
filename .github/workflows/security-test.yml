name: Prisma Cloud image scan
on: [push]
env:
  pcc_console_url: https://us-east1.cloud.twistlock.com/us-2-158320372
  pcc_user: ace48371-89ca-4173-8c8f-4cef4d825485
  pcc_pass: Lez3TmiCany8BlnHCXkmxWURCFk=
  mage_name: smartinezc/fastapi-demo-app
     
jobs: 
  twsitcli_job:

     runs-on: ubuntu-latest
     steps:
       - name: Twistcli image scan
         id: scan
         uses: PaloAltoNetworks/prisma-cloud-scan@v1.6.8
     

#name: Checkov
#on: [push]
#jobs:
  checkov: 
    needs: twsitcli_job
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.8
        uses: actions/setup-python@v4
        with:
          python-version: 3.8
      - name: Test with Checkov
        id: checkov
        uses: bridgecrewio/checkov-action@master
        with:
          directory: . 
          api-key: 132ea96b-66cf-4c62-ae33-95772e68ff1a::0EmoqoGE2+gc+kentowADdV/B50=
          prisma-api-url: https://api2.prismacloud.io
          output_format: cli
          use_enforcement_rules: True
          soft_fail: True
