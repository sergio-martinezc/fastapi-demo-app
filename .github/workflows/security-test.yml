name: Prisma Cloud image scan
on: [push]
jobs: 
  twsitcli_job:

     runs-on: ubuntu-latest
     steps:
       - name: Twistcli image scan
         id: scan
         uses: PaloAltoNetworks/prisma-cloud-scan@v1.6.8
         with:
           pcc_console_url: https://us-east1.cloud.twistlock.com/us-2-158320372
           token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoic2VtYXJ0aW5lekBwYWxvYWx0b25ldHdvcmtzLmNvbSIsInJvbGUiOiJhZG1pbiIsInJvbGVQZXJtcyI6W1syNTUsMjU1LDI1NSwyNTUsMjU1LDk1XSxbMjU1LDI1NSwyNTUsMjU1LDI1NSw5NV1dLCJzZXNzaW9uVGltZW91dFNlYyI6NjAwLCJzYWFzVG9rZW4iOiJleUpoYkdjaU9pSklVekkxTmlKOS5leUp6ZFdJaU9pSnpaVzFoY25ScGJtVjZRSEJoYkc5aGJIUnZibVYwZDI5eWEzTXVZMjl0SWl3aWMyVnlkbWxqWlZWellXZGxUMjVzZVNJNmRISjFaU3dpWm1seWMzUk1iMmRwYmlJNlptRnNjMlVzSW5CeWFYTnRZVWxrSWpvaU9UQXlOVGs1TXpRME9UYzFOelU1TXpZd0lpd2lhWEJCWkdSeVpYTnpJam9pTXpRdU1UTTVMakkwT1M0eE9USWlMQ0pwYzNNaU9pSm9kSFJ3Y3pvdkwyRndhVEl1Y0hKcGMyMWhZMnh2ZFdRdWFXOGlMQ0p5WlhOMGNtbGpkQ0k2TUN3aWRYTmxjbEp2YkdWVWVYQmxSR1YwWVdsc2N5STZleUpvWVhOUGJteDVVbVZoWkVGalkyVnpjeUk2Wm1Gc2MyVjlMQ0oxYzJWeVVtOXNaVlI1Y0dWT1lXMWxJam9pVTNsemRHVnRJRUZrYldsdUlpd2lhWE5UVTA5VFpYTnphVzl1SWpwbVlXeHpaU3dpYkdGemRFeHZaMmx1VkdsdFpTSTZNVGMwTnpNMk5UTTBPVGt5TVN3aVlYVmtJam9pYUhSMGNITTZMeTloY0dreUxuQnlhWE50WVdOc2IzVmtMbWx2SWl3aWRYTmxjbEp2YkdWVWVYQmxTV1FpT2pFc0ltRjFkR2d0YldWMGFHOWtJam9pVUVGT1gxTkJUVXd5SWl3aWMyVnNaV04wWldSRGRYTjBiMjFsY2s1aGJXVWlPaUpCVUZBeUlGQnlhWE50WVNCRGJHOTFaQ0JEZFhOMGIyMWxjaUJUZFdOalpYTnpJRXhoWWkwZ05UUXhPREUyTkRFMk56QXhPRGM1T0RBME9DSXNJbk5sYzNOcGIyNVVhVzFsYjNWMElqbzJNQ3dpZFhObGNsSnZiR1ZKWkNJNkltWXpOV001T1RnNExURm1ZVEV0TkdVM09TMWhPRFZoTFRRek1XRmxOVFZpTVRJME9DSXNJbWhoYzBSbFptVnVaR1Z5VUdWeWJXbHpjMmx2Ym5NaU9tWmhiSE5sTENKbGVIQWlPakUzTkRjek5qVTVOak1zSW1saGRDSTZNVGMwTnpNMk5UTTJNeXdpZFhObGNtNWhiV1VpT2lKelpXMWhjblJwYm1WNlFIQmhiRzloYkhSdmJtVjBkMjl5YTNNdVkyOXRJaXdpZFhObGNsSnZiR1ZPWVcxbElqb2lVM2x6ZEdWdElFRmtiV2x1SW4wLk1yTTRBS3NjNlJhYVZlY3oxa2JMQUYwUV85bzJnTjk4bzhxNG9BQXI3ZXMiLCJpc3MiOiJ0d2lzdGxvY2siLCJleHAiOjE3NDczNjg5NjN9.5PnIZ6qaVSe7hqvsPSyOYuZSrnzTsA0xURO_5-AkSJk
           #pcc_user: 323acdd4-4242-4078-a83c-7bac7101218b
           #pcc_pass: Axg5ud0uW+zetdGJL/sz5BmoDMU=
           image_name: smartinezc/fastapi-demo-app
           twistcli_debug: true

#name: Checkov
#on: [push]
#jobs:
  checkov:

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.8
        uses: actions/setup-python@v4
        with:
          python-version: 3.8
      - name: Test with Checkov
        id: checkov
        uses: bridgecrewio/checkov-action@master
        with:
          directory: . 
          api-key: 132ea96b-66cf-4c62-ae33-95772e68ff1a::0EmoqoGE2+gc+kentowADdV/B50=
          prisma-api-url: https://api2.prismacloud.io
          output_format: cli
          use_enforcement_rules: True
          soft_fail: True
